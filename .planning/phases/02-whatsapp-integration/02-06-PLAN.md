---
phase: 02-whatsapp-integration
plan: 06
type: execute
wave: 3
depends_on: ["02-02"]
files_modified:
  - src/views/whatsapp-connect.ts
  - src/views/index.ts
  - src/routes/pages.ts
  - src/index.ts
  - public/js/whatsapp-signup.js
autonomous: false

must_haves:
  truths:
    - "User clicks 'Connect WhatsApp' button and sees Meta Embedded Signup popup"
    - "Popup completion sends credentials to POST /api/whatsapp callback"
    - "Success screen shows connected phone number and business name"
    - "Error screen shows specific error message and retry guidance"
    - "Dimmed overlay appears while popup is open"
  artifacts:
    - path: "src/views/whatsapp-connect.ts"
      provides: "WhatsApp connection page with Embedded Signup UI"
      exports: ["renderWhatsAppConnectPage"]
    - path: "public/js/whatsapp-signup.js"
      provides: "Client-side Meta SDK integration"
      contains: "FB.login"
    - path: "src/routes/pages.ts"
      provides: "Page routes for HTML views"
      contains: "/connect/whatsapp"
  key_links:
    - from: "public/js/whatsapp-signup.js"
      to: "/api/whatsapp"
      via: "fetch to POST callback endpoint"
      pattern: "fetch.*api/whatsapp"
    - from: "public/js/whatsapp-signup.js"
      to: "FB.login"
      via: "Meta JavaScript SDK"
      pattern: "FB\\.login"
---

<objective>
Create the frontend UI for WhatsApp connection via Meta Embedded Signup. User clicks "Connect WhatsApp", completes Meta popup, and system handles success/error states.

Purpose: Per Success Criterion 1, users must be able to click "Connect WhatsApp" and complete Meta Embedded Signup without leaving the app. This plan provides the frontend that triggers FB.login and sends credentials to the callback endpoint created in 02-02.

Output: Minimal HTML page served by Hono with embedded JavaScript for Meta SDK integration.
</objective>

<execution_context>
@C:\Users\דודאלמועלם\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\דודאלמועלם\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02-whatsapp-integration/02-CONTEXT.md
@.planning/phases/02-whatsapp-integration/02-RESEARCH.md

# From 02-02 - the callback endpoint this UI calls
@src/routes/whatsapp/callback.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create WhatsApp connection page view</name>
  <files>
    src/views/whatsapp-connect.ts
    src/views/index.ts
    src/routes/pages.ts
    src/index.ts
    public/js/whatsapp-signup.js
  </files>
  <action>
Create the WhatsApp connection page with Meta Embedded Signup integration.

**Create directory structure:**
```bash
mkdir -p public/js
mkdir -p src/views
```

**src/views/whatsapp-connect.ts:**

```typescript
/**
 * WhatsApp Connection Page
 *
 * Renders the "Connect WhatsApp" UI with Meta Embedded Signup integration.
 * Per CONTEXT.md:
 * - Dimmed overlay with spinner while popup is open
 * - Confirmation dialog if user closes without completing
 * - Success screen with phone number and business name
 * - Error screen with specific guidance
 */

interface WhatsAppConnectOptions {
  metaAppId: string;
  metaConfigId: string;
  tenantId: string;
  callbackUrl: string;
}

export function renderWhatsAppConnectPage(options: WhatsAppConnectOptions): string {
  return `<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>חיבור WhatsApp - Findo</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.1);
      max-width: 480px;
      width: 100%;
      padding: 40px;
      text-align: center;
    }
    .logo {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
      border-radius: 20px;
      margin: 0 auto 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .logo svg { fill: white; width: 48px; height: 48px; }
    h1 { font-size: 24px; color: #1a1a1a; margin-bottom: 12px; }
    .subtitle { color: #666; margin-bottom: 32px; line-height: 1.5; }
    .connect-btn {
      background: #25D366;
      color: white;
      border: none;
      padding: 16px 32px;
      font-size: 18px;
      font-weight: 600;
      border-radius: 12px;
      cursor: pointer;
      width: 100%;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .connect-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(37, 211, 102, 0.3);
    }
    .connect-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    /* Overlay */
    .overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .overlay.active { display: flex; }
    .overlay-content {
      background: white;
      padding: 32px;
      border-radius: 16px;
      text-align: center;
    }
    .spinner {
      width: 48px;
      height: 48px;
      border: 4px solid #e5e5e5;
      border-top-color: #25D366;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Success State */
    .success-state { display: none; }
    .success-state.active { display: block; }
    .success-icon {
      width: 80px;
      height: 80px;
      background: #25D366;
      border-radius: 50%;
      margin: 0 auto 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .success-icon svg { fill: white; width: 40px; height: 40px; }
    .success-details {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 20px;
      margin: 24px 0;
      text-align: right;
    }
    .success-details dt { color: #666; font-size: 14px; margin-bottom: 4px; }
    .success-details dd { color: #1a1a1a; font-size: 16px; font-weight: 500; margin-bottom: 16px; }
    .success-details dd:last-child { margin-bottom: 0; }
    .continue-btn {
      background: #1a1a1a;
      color: white;
      border: none;
      padding: 16px 32px;
      font-size: 16px;
      font-weight: 600;
      border-radius: 12px;
      cursor: pointer;
      width: 100%;
    }

    /* Error State */
    .error-state { display: none; }
    .error-state.active { display: block; }
    .error-icon {
      width: 80px;
      height: 80px;
      background: #dc3545;
      border-radius: 50%;
      margin: 0 auto 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .error-icon svg { fill: white; width: 40px; height: 40px; }
    .error-message {
      color: #dc3545;
      background: #fff5f5;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 24px;
    }
    .error-guidance {
      text-align: right;
      background: #f8f9fa;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 24px;
    }
    .error-guidance h3 { font-size: 14px; color: #666; margin-bottom: 8px; }
    .error-guidance ul { padding-right: 20px; color: #1a1a1a; line-height: 1.8; }
    .retry-btn {
      background: #25D366;
      color: white;
      border: none;
      padding: 16px 32px;
      font-size: 16px;
      font-weight: 600;
      border-radius: 12px;
      cursor: pointer;
      width: 100%;
    }

    /* Initial State */
    .initial-state { }
    .initial-state.hidden { display: none; }
  </style>
</head>
<body>
  <div class="container">
    <!-- Initial State -->
    <div class="initial-state" id="initialState">
      <div class="logo">
        <svg viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
      </div>
      <h1>חיבור WhatsApp לעסק</h1>
      <p class="subtitle">חבר את חשבון ה-WhatsApp Business שלך כדי לקבל ולשלוח הודעות ללקוחות באופן אוטומטי</p>
      <button class="connect-btn" id="connectBtn" onclick="launchWhatsAppSignup()">
        חבר את WhatsApp
      </button>
    </div>

    <!-- Success State -->
    <div class="success-state" id="successState">
      <div class="success-icon">
        <svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
      </div>
      <h1>WhatsApp מחובר בהצלחה!</h1>
      <dl class="success-details">
        <dt>מספר טלפון</dt>
        <dd id="connectedPhone">-</dd>
        <dt>שם העסק</dt>
        <dd id="connectedBusiness">-</dd>
      </dl>
      <button class="continue-btn" onclick="window.location.href='/dashboard'">המשך ללוח הבקרה</button>
    </div>

    <!-- Error State -->
    <div class="error-state" id="errorState">
      <div class="error-icon">
        <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
      </div>
      <h1>החיבור נכשל</h1>
      <div class="error-message" id="errorMessage">שגיאה לא ידועה</div>
      <div class="error-guidance">
        <h3>מה אפשר לנסות:</h3>
        <ul id="errorGuidance">
          <li>וודא שמספר הטלפון לא רשום ב-WhatsApp אחר</li>
          <li>נסה שוב בעוד מספר דקות</li>
          <li>פנה לתמיכה אם הבעיה נמשכת</li>
        </ul>
      </div>
      <button class="retry-btn" onclick="resetToInitial()">נסה שוב</button>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="overlay" id="overlay">
    <div class="overlay-content">
      <div class="spinner"></div>
      <p>ממתין לסיום ההרשמה...</p>
    </div>
  </div>

  <!-- Confirmation Dialog (on close attempt) -->
  <div class="overlay" id="confirmDialog">
    <div class="overlay-content">
      <h2 style="margin-bottom: 16px;">בטוח שברצונך לבטל?</h2>
      <p style="margin-bottom: 24px; color: #666;">תצטרך להתחיל את התהליך מההתחלה</p>
      <div style="display: flex; gap: 12px;">
        <button onclick="closeConfirmDialog()" style="flex: 1; padding: 12px; background: #e5e5e5; border: none; border-radius: 8px; cursor: pointer;">חזור לתהליך</button>
        <button onclick="confirmCancel()" style="flex: 1; padding: 12px; background: #dc3545; color: white; border: none; border-radius: 8px; cursor: pointer;">בטל חיבור</button>
      </div>
    </div>
  </div>

  <!-- Meta SDK -->
  <script async defer crossorigin="anonymous"
    src="https://connect.facebook.net/he_IL/sdk.js">
  </script>

  <script>
    // Configuration from server
    const CONFIG = {
      appId: '${options.metaAppId}',
      configId: '${options.metaConfigId}',
      tenantId: '${options.tenantId}',
      callbackUrl: '${options.callbackUrl}'
    };
  </script>
  <script src="/public/js/whatsapp-signup.js"></script>
</body>
</html>`;
}
```

**public/js/whatsapp-signup.js:**

```javascript
/**
 * WhatsApp Embedded Signup Client
 *
 * Handles Meta JavaScript SDK integration for Embedded Signup flow.
 * Per CONTEXT.md and RESEARCH.md:
 * - Uses FB.login with config_id for Embedded Signup v2
 * - Extracts WABA ID, Phone Number ID from sessionInfo
 * - Sends credentials to POST /api/whatsapp callback via fetch
 */

// State tracking
let isSignupInProgress = false;
let popupCheckInterval = null;

// Initialize Facebook SDK
window.fbAsyncInit = function() {
  FB.init({
    appId: CONFIG.appId,
    cookie: true,
    xfbml: true,
    version: 'v21.0'
  });

  console.log('[whatsapp-signup] Facebook SDK initialized');
};

/**
 * Launch WhatsApp Embedded Signup popup
 */
function launchWhatsAppSignup() {
  if (isSignupInProgress) {
    console.log('[whatsapp-signup] Signup already in progress');
    return;
  }

  isSignupInProgress = true;
  showOverlay();

  // Disable connect button
  const btn = document.getElementById('connectBtn');
  if (btn) btn.disabled = true;

  // Launch FB.login with Embedded Signup configuration
  FB.login(function(response) {
    console.log('[whatsapp-signup] FB.login response:', response);

    if (response.authResponse) {
      // User completed the signup
      handleSignupSuccess(response);
    } else {
      // User cancelled or error occurred
      handleSignupCancelled();
    }
  }, {
    config_id: CONFIG.configId,
    response_type: 'code',
    override_default_response_type: true,
    extras: {
      setup: {},
      featureType: 'only_waba_sharing',
      sessionInfoVersion: 2
    }
  });

  // Start monitoring for popup close (user might close without completing)
  startPopupMonitoring();
}

/**
 * Handle successful Embedded Signup completion
 */
async function handleSignupSuccess(response) {
  console.log('[whatsapp-signup] Processing successful signup');

  try {
    // Extract session info (contains WABA ID and Phone Number ID)
    const sessionInfo = response.authResponse.decryptedSessionInfo ||
                        extractSessionInfo(response);

    if (!sessionInfo) {
      throw new Error('Could not extract session info from response');
    }

    // Prepare payload for backend
    const payload = {
      code: response.authResponse.code,
      wabaId: sessionInfo.waba_id || sessionInfo.wabaId,
      phoneNumberId: sessionInfo.phone_number_id || sessionInfo.phoneNumberId,
      displayPhoneNumber: sessionInfo.display_phone_number || sessionInfo.displayPhoneNumber,
      businessName: sessionInfo.business_name || sessionInfo.businessName
    };

    console.log('[whatsapp-signup] Sending to backend:', {
      ...payload,
      code: payload.code.slice(0, 10) + '...' // Truncate code in logs
    });

    // Send to backend callback endpoint via fetch to /api/whatsapp
    const result = await fetch(CONFIG.callbackUrl, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        // Tenant context will be handled by cookie/header set during page load
      },
      credentials: 'include',
      body: JSON.stringify(payload)
    });

    const data = await result.json();

    if (!result.ok || !data.success) {
      throw new Error(data.error || 'Backend processing failed');
    }

    // Show success state
    showSuccessState({
      phoneNumber: payload.displayPhoneNumber || payload.phoneNumberId,
      businessName: payload.businessName || 'העסק שלך'
    });

  } catch (error) {
    console.error('[whatsapp-signup] Error processing signup:', error);
    showErrorState({
      message: error.message || 'שגיאה בעיבוד החיבור',
      guidance: getErrorGuidance(error)
    });
  } finally {
    isSignupInProgress = false;
    stopPopupMonitoring();
    hideOverlay();
  }
}

/**
 * Handle cancelled or failed signup
 */
function handleSignupCancelled() {
  console.log('[whatsapp-signup] Signup cancelled by user');

  isSignupInProgress = false;
  stopPopupMonitoring();
  hideOverlay();

  // Re-enable connect button
  const btn = document.getElementById('connectBtn');
  if (btn) btn.disabled = false;
}

/**
 * Extract session info from response
 * sessionInfo may come encrypted or in different formats
 */
function extractSessionInfo(response) {
  // Try different paths where session info might be
  if (response.authResponse.sessionInfo) {
    try {
      return JSON.parse(response.authResponse.sessionInfo);
    } catch (e) {
      return response.authResponse.sessionInfo;
    }
  }

  // Fallback: construct from available data
  if (response.authResponse.userID) {
    return {
      waba_id: response.authResponse.waba_id,
      phone_number_id: response.authResponse.phone_number_id
    };
  }

  return null;
}

/**
 * Get error guidance based on error type
 */
function getErrorGuidance(error) {
  const message = error.message?.toLowerCase() || '';

  if (message.includes('already registered') || message.includes('phone')) {
    return [
      'מספר הטלפון כבר רשום ב-WhatsApp אחר',
      'עבור להגדרות WhatsApp > חשבון > מחק חשבון',
      'המתן 24 שעות ונסה שוב'
    ];
  }

  if (message.includes('token') || message.includes('auth')) {
    return [
      'הייתה בעיה באימות מול Meta',
      'נסה לרענן את הדף ולהתחבר מחדש',
      'וודא שיש לך הרשאות ניהול בחשבון העסקי'
    ];
  }

  // Default guidance
  return [
    'וודא שמספר הטלפון לא רשום ב-WhatsApp אחר',
    'נסה שוב בעוד מספר דקות',
    'פנה לתמיכה אם הבעיה נמשכת'
  ];
}

// UI State Functions

function showOverlay() {
  document.getElementById('overlay').classList.add('active');
}

function hideOverlay() {
  document.getElementById('overlay').classList.remove('active');
}

function showSuccessState(data) {
  document.getElementById('initialState').classList.add('hidden');
  document.getElementById('errorState').classList.remove('active');
  document.getElementById('successState').classList.add('active');

  document.getElementById('connectedPhone').textContent = data.phoneNumber;
  document.getElementById('connectedBusiness').textContent = data.businessName;
}

function showErrorState(data) {
  document.getElementById('initialState').classList.add('hidden');
  document.getElementById('successState').classList.remove('active');
  document.getElementById('errorState').classList.add('active');

  document.getElementById('errorMessage').textContent = data.message;

  const guidanceList = document.getElementById('errorGuidance');
  guidanceList.innerHTML = data.guidance.map(item => '<li>' + item + '</li>').join('');
}

function resetToInitial() {
  document.getElementById('initialState').classList.remove('hidden');
  document.getElementById('successState').classList.remove('active');
  document.getElementById('errorState').classList.remove('active');

  const btn = document.getElementById('connectBtn');
  if (btn) btn.disabled = false;
}

// Popup monitoring for user closing without completing

function startPopupMonitoring() {
  // Check periodically if popup is still open
  // This helps detect when user closes popup without completing
  popupCheckInterval = setInterval(function() {
    // FB SDK doesn't expose popup state directly
    // This is a heuristic based on overlay still being visible
  }, 1000);
}

function stopPopupMonitoring() {
  if (popupCheckInterval) {
    clearInterval(popupCheckInterval);
    popupCheckInterval = null;
  }
}

// Confirmation dialog functions

function showConfirmDialog() {
  document.getElementById('confirmDialog').classList.add('active');
}

function closeConfirmDialog() {
  document.getElementById('confirmDialog').classList.remove('active');
}

function confirmCancel() {
  closeConfirmDialog();
  handleSignupCancelled();
}
```

**src/views/index.ts:**

```typescript
export { renderWhatsAppConnectPage } from './whatsapp-connect';
```

**src/routes/pages.ts:**

```typescript
import { Hono } from 'hono';
import { serveStatic } from '@hono/node-server/serve-static';
import { renderWhatsAppConnectPage } from '../views/index';
import { tenantContextMiddleware } from '../middleware/tenant-context';

export const pagesRoutes = new Hono();

// Serve static files
pagesRoutes.use('/public/*', serveStatic({ root: './' }));

// WhatsApp connection page
pagesRoutes.get('/connect/whatsapp', tenantContextMiddleware, async (c) => {
  const tenantId = c.get('tenantId');

  if (!tenantId) {
    return c.redirect('/login?redirect=/connect/whatsapp');
  }

  const html = renderWhatsAppConnectPage({
    metaAppId: process.env.META_APP_ID || '',
    metaConfigId: process.env.META_CONFIG_ID || '',
    tenantId,
    callbackUrl: '/api/whatsapp',
  });

  return c.html(html);
});

// Health check page (simple)
pagesRoutes.get('/', (c) => {
  return c.text('Findo API Server');
});
```

**Update src/index.ts** to mount pages routes:

Add import:
```typescript
import { pagesRoutes } from './routes/pages';
```

Add route mount (near other routes):
```typescript
// Page routes (HTML views)
app.route('/', pagesRoutes);
```

Ensure static directory exists and serveStatic works.
  </action>
  <verify>
    - Files exist: src/views/whatsapp-connect.ts, public/js/whatsapp-signup.js
    - Server starts: `pnpm dev`
    - Visit http://localhost:3000/connect/whatsapp shows WhatsApp connection page
    - Page loads Facebook SDK without console errors
    - TypeScript compiles: `pnpm tsc --noEmit`
  </verify>
  <done>
    WhatsApp connection page renders with Connect button, Meta SDK loads, and page structure supports success/error states per CONTEXT.md requirements.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify WhatsApp connection UI flow</name>
  <what-built>
    WhatsApp connection page with:
    - "Connect WhatsApp" button that triggers Meta Embedded Signup popup
    - Dimmed overlay while popup is open
    - Success screen showing connected phone number and business name
    - Error screen with specific guidance
    - Client-side JavaScript that calls POST /api/whatsapp callback with signup data
  </what-built>
  <how-to-verify>
    1. Start dev server: `pnpm dev`
    2. Visit http://localhost:3000/connect/whatsapp (with tenant context)
    3. Verify page loads with Hebrew text and WhatsApp branding
    4. Click "Connect WhatsApp" button - popup should attempt to open
    5. If META_APP_ID and META_CONFIG_ID are configured:
       - Complete the Embedded Signup flow
       - Verify credentials are sent to /api/whatsapp
       - Verify success screen shows phone number and business name
    6. If credentials are not configured:
       - Verify error handling shows appropriate message
       - Verify retry button works
    7. Check browser console for any JavaScript errors
  </how-to-verify>
  <resume-signal>Type "approved" if the UI flow works correctly, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Page rendering verification:**
   - GET /connect/whatsapp returns HTML page
   - Page shows Connect button with WhatsApp branding
   - Facebook SDK loads from connect.facebook.net

2. **UI state verification:**
   - Initial state shows Connect button
   - Clicking button shows overlay and triggers FB.login
   - Success state shows phone number and business name
   - Error state shows message and guidance

3. **Integration verification:**
   - On successful popup completion, fetch calls POST /api/whatsapp
   - Response from backend triggers appropriate state change

4. **TypeScript verification:**
   - `pnpm tsc --noEmit` passes
</verification>

<success_criteria>
- GET /connect/whatsapp renders WhatsApp connection page
- Page loads Facebook JavaScript SDK (v21.0)
- "Connect WhatsApp" button triggers FB.login with config_id
- Dimmed overlay appears while popup is open
- On popup completion, credentials sent to POST /api/whatsapp via fetch
- Success screen shows connected phone number and business name
- Error screen shows specific error message and guidance list
- All UI text is in Hebrew
</success_criteria>

<output>
After completion, create `.planning/phases/02-whatsapp-integration/02-06-SUMMARY.md`
</output>
