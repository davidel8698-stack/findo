---
phase: 12-technical-foundation
plan: 03
type: execute
wave: 2
depends_on: ["12-01"]
files_modified:
  - website/package.json
  - website/src/app/layout.tsx
  - website/src/app/globals.css
  - website/src/lib/gsapConfig.ts
  - website/src/components/SmoothScroll.tsx
  - website/src/providers/MotionProvider.tsx
autonomous: true

must_haves:
  truths:
    - "Heebo font loads without FOUT (font-display: swap)"
    - "Motion animations work with LazyMotion tree-shaking"
    - "GSAP ScrollTrigger registered via centralized config"
    - "Lenis smooth scroll synchronized with ScrollTrigger"
    - "Provider nesting order correct: DirectionProvider > MotionProvider > SmoothScroll"
  artifacts:
    - path: "website/src/app/layout.tsx"
      provides: "Heebo font configuration with preload and provider nesting"
      contains: "Heebo"
    - path: "website/src/lib/gsapConfig.ts"
      provides: "Centralized GSAP configuration"
      contains: "gsap.registerPlugin"
    - path: "website/src/providers/MotionProvider.tsx"
      provides: "LazyMotion wrapper for tree-shaking"
      contains: "LazyMotion"
    - path: "website/src/components/SmoothScroll.tsx"
      provides: "Lenis + GSAP ticker integration"
      contains: "lenis.on"
  key_links:
    - from: "website/src/app/layout.tsx"
      to: "next/font/google"
      via: "Heebo font import"
      pattern: "import.*Heebo.*from.*next/font/google"
    - from: "website/src/lib/gsapConfig.ts"
      to: "gsap/ScrollTrigger"
      via: "Plugin registration"
      pattern: "gsap.registerPlugin.*ScrollTrigger"
    - from: "website/src/components/SmoothScroll.tsx"
      to: "ScrollTrigger.update"
      via: "Lenis scroll event"
      pattern: "lenis.on.*scroll.*ScrollTrigger.update"
    - from: "website/src/app/layout.tsx"
      to: "providers"
      via: "Provider nesting order"
      pattern: "DirectionProvider.*MotionProvider.*SmoothScroll"
---

<objective>
Configure Heebo Hebrew font with optimization and set up animation infrastructure (Motion + GSAP + Lenis).

Purpose: Establish font loading without FOUT and animation libraries with tree-shaking for optimal bundle size.
Output: Heebo font preloaded, Motion LazyMotion configured, GSAP centralized setup, Lenis smooth scroll integrated.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/12-technical-foundation/12-RESEARCH.md
@.planning/phases/12-technical-foundation/12-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure Heebo font with next/font optimization</name>
  <files>
    website/src/app/layout.tsx
    website/src/app/globals.css
  </files>
  <action>
    Update website/src/app/layout.tsx to configure Heebo font:

    ```tsx
    import type { Metadata, Viewport } from "next";
    import { Heebo } from "next/font/google";
    import { DirectionProvider } from "@radix-ui/react-direction";
    import "./globals.css";

    const heebo = Heebo({
      subsets: ["hebrew"],
      display: "swap",
      weight: ["400", "500", "700"],
      variable: "--font-heebo",
      fallback: ["Arial", "sans-serif"],
      preload: true,
    });

    export const viewport: Viewport = {
      width: "device-width",
      initialScale: 1,
      maximumScale: 5,
      themeColor: "#ffffff",
    };

    export const metadata: Metadata = {
      title: "Findo - Automatic Business Growth",
      description: "Autonomous lead capture, review management, and Google Business Profile optimization for Israeli SMBs",
    };

    export default function RootLayout({
      children,
    }: Readonly<{
      children: React.ReactNode;
    }>) {
      return (
        <html lang="he" dir="rtl" className={heebo.variable}>
          <body className="font-sans antialiased">
            <DirectionProvider dir="rtl">
              {children}
            </DirectionProvider>
          </body>
        </html>
      );
    }
    ```

    Update website/src/app/globals.css to use font variable:

    ```css
    @import "tailwindcss";

    @theme {
      --font-sans: var(--font-heebo), system-ui, sans-serif;
    }
    ```

    Key configuration:
    - subsets: ["hebrew"] - Only load Hebrew character set (smaller download)
    - display: "swap" - Show fallback font immediately, swap when loaded (no FOUT)
    - weight: ["400", "500", "700"] - Regular, Medium, Bold (cover all needs)
    - variable: "--font-heebo" - CSS variable for Tailwind integration
    - fallback: ["Arial", "sans-serif"] - Hebrew-compatible fallback chain
    - preload: true - Preload font file in document head

    NOTE: Do NOT use adjustFontFallback option - it's broken in Next.js 15.
  </action>
  <verify>
    Run `cd website && npm run build` passes.
    Run `cd website && npm run dev` and inspect page source.
    Look for preload link with Heebo font file.
    Verify body text uses Heebo font (inspect computed styles).
    Hebrew text should render in Heebo, not system font.
  </verify>
  <done>
    Heebo font configured with preload, swap display, and Tailwind integration.
  </done>
</task>

<task type="auto">
  <name>Task 2: Install animation libraries and create GSAP config</name>
  <files>
    website/package.json
    website/src/lib/gsapConfig.ts
  </files>
  <action>
    From website/ directory, install animation libraries:

    ```bash
    cd website
    npm install motion gsap @gsap/react lenis
    ```

    Create website/src/lib/gsapConfig.ts:

    ```typescript
    "use client";

    import { gsap } from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";
    import { useGSAP } from "@gsap/react";

    // Register plugins once globally
    if (typeof window !== "undefined") {
      gsap.registerPlugin(ScrollTrigger, useGSAP);
    }

    // Export configured GSAP instance and hooks
    export { gsap, ScrollTrigger, useGSAP };
    ```

    Create directory structure:
    ```bash
    mkdir -p website/src/lib
    mkdir -p website/src/components
    mkdir -p website/src/providers
    ```

    This centralized config:
    - Prevents redundant plugin registration across components
    - Ensures consistent GSAP setup
    - Uses "use client" for client-only execution
    - Exports configured instances for use throughout app

    CRITICAL: Always import from @/lib/gsapConfig, never directly from "gsap".
  </action>
  <verify>
    Run `cd website && npm list motion gsap @gsap/react lenis` shows all packages installed.
    File website/src/lib/gsapConfig.ts exists.
    Run `cd website && npm run build` passes (no SSR errors).
  </verify>
  <done>
    Animation libraries installed and GSAP centralized configuration created.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Motion LazyMotion provider</name>
  <files>
    website/src/providers/MotionProvider.tsx
    website/src/app/layout.tsx
  </files>
  <action>
    Create website/src/providers/MotionProvider.tsx:

    ```tsx
    "use client";

    import { LazyMotion, domAnimation } from "motion/react";

    interface MotionProviderProps {
      children: React.ReactNode;
    }

    export function MotionProvider({ children }: MotionProviderProps) {
      return (
        <LazyMotion features={domAnimation} strict>
          {children}
        </LazyMotion>
      );
    }
    ```

    Update website/src/app/layout.tsx to add MotionProvider:

    ```tsx
    import type { Metadata, Viewport } from "next";
    import { Heebo } from "next/font/google";
    import { DirectionProvider } from "@radix-ui/react-direction";
    import { MotionProvider } from "@/providers/MotionProvider";
    import "./globals.css";

    const heebo = Heebo({
      subsets: ["hebrew"],
      display: "swap",
      weight: ["400", "500", "700"],
      variable: "--font-heebo",
      fallback: ["Arial", "sans-serif"],
      preload: true,
    });

    export const viewport: Viewport = {
      width: "device-width",
      initialScale: 1,
      maximumScale: 5,
      themeColor: "#ffffff",
    };

    export const metadata: Metadata = {
      title: "Findo - Automatic Business Growth",
      description: "Autonomous lead capture, review management, and Google Business Profile optimization for Israeli SMBs",
    };

    export default function RootLayout({
      children,
    }: Readonly<{
      children: React.ReactNode;
    }>) {
      return (
        <html lang="he" dir="rtl" className={heebo.variable}>
          <body className="font-sans antialiased">
            <DirectionProvider dir="rtl">
              <MotionProvider>
                {children}
              </MotionProvider>
            </DirectionProvider>
          </body>
        </html>
      );
    }
    ```

    Provider order (outer to inner) - CRITICAL for RTL:
    1. DirectionProvider - RTL context for Radix components (MUST be outermost)
    2. MotionProvider - LazyMotion for tree-shaking

    Bundle size benefit:
    - LazyMotion with domAnimation: 4.6KB (vs 34KB full motion)
  </action>
  <verify>
    Run `cd website && npm run build` passes.
    File website/src/providers/MotionProvider.tsx exists.
    layout.tsx has providers in correct order: DirectionProvider > MotionProvider.
    Check browser console for no errors.
  </verify>
  <done>
    Motion LazyMotion provider created and nested correctly inside DirectionProvider.
  </done>
</task>

<task type="auto">
  <name>Task 4: Create Lenis smooth scroll with GSAP integration</name>
  <files>
    website/src/components/SmoothScroll.tsx
    website/src/app/layout.tsx
  </files>
  <action>
    Create website/src/components/SmoothScroll.tsx:

    ```tsx
    "use client";

    import { useEffect } from "react";
    import Lenis from "lenis";
    import { gsap, ScrollTrigger } from "@/lib/gsapConfig";

    interface SmoothScrollProps {
      children: React.ReactNode;
    }

    export function SmoothScroll({ children }: SmoothScrollProps) {
      useEffect(() => {
        // Initialize Lenis
        const lenis = new Lenis({
          duration: 1.2,
          easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
          orientation: "vertical",
          gestureOrientation: "vertical",
          smoothWheel: true,
          wheelMultiplier: 1,
          touchMultiplier: 2,
        });

        // Synchronize Lenis with GSAP ScrollTrigger
        lenis.on("scroll", ScrollTrigger.update);

        // Add Lenis to GSAP ticker
        const rafCallback = (time: number) => {
          lenis.raf(time * 1000);
        };
        gsap.ticker.add(rafCallback);

        // Disable GSAP lag smoothing (prevents delays)
        gsap.ticker.lagSmoothing(0);

        // Cleanup on unmount
        return () => {
          lenis.destroy();
          gsap.ticker.remove(rafCallback);
        };
      }, []);

      return <>{children}</>;
    }
    ```

    Update website/src/app/layout.tsx to add SmoothScroll:

    ```tsx
    import type { Metadata, Viewport } from "next";
    import { Heebo } from "next/font/google";
    import { DirectionProvider } from "@radix-ui/react-direction";
    import { MotionProvider } from "@/providers/MotionProvider";
    import { SmoothScroll } from "@/components/SmoothScroll";
    import "./globals.css";

    const heebo = Heebo({
      subsets: ["hebrew"],
      display: "swap",
      weight: ["400", "500", "700"],
      variable: "--font-heebo",
      fallback: ["Arial", "sans-serif"],
      preload: true,
    });

    export const viewport: Viewport = {
      width: "device-width",
      initialScale: 1,
      maximumScale: 5,
      themeColor: "#ffffff",
    };

    export const metadata: Metadata = {
      title: "Findo - Automatic Business Growth",
      description: "Autonomous lead capture, review management, and Google Business Profile optimization for Israeli SMBs",
    };

    export default function RootLayout({
      children,
    }: Readonly<{
      children: React.ReactNode;
    }>) {
      return (
        <html lang="he" dir="rtl" className={heebo.variable}>
          <body className="font-sans antialiased">
            <DirectionProvider dir="rtl">
              <MotionProvider>
                <SmoothScroll>
                  {children}
                </SmoothScroll>
              </MotionProvider>
            </DirectionProvider>
          </body>
        </html>
      );
    }
    ```

    Provider order (outer to inner) - CRITICAL for RTL:
    1. DirectionProvider - RTL context for Radix components (MUST be outermost)
    2. MotionProvider - LazyMotion for tree-shaking
    3. SmoothScroll - Lenis smooth scroll with GSAP sync (innermost)

    CRITICAL: Wrong order breaks RTL. DirectionProvider MUST be outermost to ensure
    all child components receive RTL context correctly.

    Bundle size benefits:
    - GSAP imports only ScrollTrigger (tree-shakeable)
    - Lenis is lightweight (2.8KB)
  </action>
  <verify>
    Run `cd website && npm run build` passes.
    Run `cd website && npm run dev` and scroll the page.
    Scrolling should feel smooth (Lenis effect).
    Check browser console for no errors.
    Verify no "window is not defined" errors (SSR safe).
    CRITICAL: Verify provider nesting order in layout.tsx:
      DirectionProvider > MotionProvider > SmoothScroll
  </verify>
  <done>
    Lenis smooth scroll configured with GSAP integration and correct provider nesting order.
  </done>
</task>

</tasks>

<verification>
All checks must pass:
1. `cd website && npm run build` completes successfully
2. Heebo font preloads in document head (check page source)
3. Hebrew text renders in Heebo font (check computed styles)
4. Page scrolling is smooth (Lenis effect visible)
5. No SSR errors (window/document not defined)
6. No duplicate GSAP plugin registration warnings in console
7. LazyMotion wraps application (check React DevTools)
8. Provider nesting order correct: DirectionProvider > MotionProvider > SmoothScroll
</verification>

<success_criteria>
- Heebo font loads with font-display: swap (no FOUT)
- Motion library configured with LazyMotion tree-shaking
- GSAP centralized config prevents duplicate registration
- Lenis smooth scroll works and syncs with ScrollTrigger
- All providers properly nested in layout (DirectionProvider outermost)
- Build passes without SSR errors
</success_criteria>

<output>
After completion, create `.planning/phases/12-technical-foundation/12-03-SUMMARY.md`
</output>
