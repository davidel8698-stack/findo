---
phase: 18-emotional-journey-demo
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - website/package.json
  - website/components/sections/demo/LottieDemo.tsx
  - website/components/sections/demo/DemoSection.tsx
  - website/public/animations/.gitkeep
  - website/public/images/demo-poster.svg
autonomous: true

must_haves:
  truths:
    - "Demo plays smoothly without blocking page load"
    - "Poster image shows before animation loads"
    - "Demo works on mobile with touch controls"
    - "CTA appears after demo completion"
  artifacts:
    - path: "website/components/sections/demo/LottieDemo.tsx"
      provides: "Lazy-loaded Lottie player with poster"
      min_lines: 80
    - path: "website/components/sections/demo/DemoSection.tsx"
      provides: "Demo section wrapper with CTA"
      min_lines: 50
  key_links:
    - from: "LottieDemo.tsx"
      to: "lottie-react"
      via: "import Lottie"
      pattern: "import.*lottie-react"
    - from: "LottieDemo.tsx"
      to: "useInView"
      via: "viewport detection for lazy load"
      pattern: "useInView.*amount.*0\\."
---

<objective>
Create the Lottie-based animated video demo component with lazy loading, poster image fallback, and completion CTA. This provides the visual explanation of how Findo works in under 90 seconds.

Purpose: Show the complete customer journey (missed call -> WhatsApp -> lead captured -> review request -> 5-star review) through engaging animation that loads fast and doesn't impact LCP.

Output: LottieDemo component with lazy loading, DemoSection wrapper ready for homepage integration.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-emotional-journey-demo/18-CONTEXT.md
@.planning/phases/18-emotional-journey-demo/18-RESEARCH.md

# Animation infrastructure
@website/components/motion/variants.ts
@website/lib/animation.ts

# Existing video pattern
@website/components/sections/social-proof/VideoTestimonial.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install lottie-react and create poster placeholder</name>
  <files>website/package.json, website/public/animations/.gitkeep, website/public/images/demo-poster.svg</files>
  <action>
1. Install lottie-react:
   ```bash
   cd website && npm install lottie-react
   ```
   Note: Use npm (not pnpm) due to OneDrive sync issues established in STATE.md

2. Create animations directory with .gitkeep:
   ```bash
   mkdir -p website/public/animations
   touch website/public/animations/.gitkeep
   ```

3. Create poster image placeholder (website/public/images/demo-poster.svg):
   Simple SVG with Findo branding and "Play Demo" visual cue.

   ```svg
   <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 450">
     <defs>
       <linearGradient id="bg" x1="0%" y1="0%" x2="100%" y2="100%">
         <stop offset="0%" style="stop-color:#fff7ed"/>
         <stop offset="100%" style="stop-color:#ffedd5"/>
       </linearGradient>
     </defs>
     <rect width="800" height="450" fill="url(#bg)"/>
     <circle cx="400" cy="225" r="60" fill="#f97316"/>
     <polygon points="385,195 385,255 430,225" fill="white"/>
     <text x="400" y="350" text-anchor="middle" font-family="system-ui" font-size="24" fill="#9a3412">
       לחץ לצפייה בדמו
     </text>
   </svg>
   ```

Note: Real Lottie animation will be provided separately. The component uses external URL pattern to fetch animation JSON at runtime, so no manual JSON file creation needed.
  </action>
  <verify>
Run: `cd website && npm ls lottie-react`
- lottie-react shows as installed
- No npm warnings about peer dependencies
- Poster SVG exists at website/public/images/demo-poster.svg
  </verify>
  <done>
lottie-react installed, animations directory created, poster SVG placeholder ready
  </done>
</task>

<task type="auto">
  <name>Task 2: Create LottieDemo component with lazy loading</name>
  <files>website/components/sections/demo/LottieDemo.tsx</files>
  <action>
Create LottieDemo.tsx following research patterns:

```typescript
"use client";

import { useRef, useState, useCallback, useEffect } from "react";
import { useInView } from "motion/react";
import Lottie, { LottieRefCurrentProps } from "lottie-react";
import { Play, RotateCcw } from "lucide-react";
import { Button } from "@/components/ui/button";
import { cn } from "@/lib/utils";

type DemoState = "poster" | "loading" | "playing" | "completed";

interface LottieDemoProps {
  /** URL to fetch Lottie JSON from, or inline animation data */
  animationUrl?: string;
  animationData?: object;
  poster: string;
  className?: string;
  onComplete?: () => void;
}

export function LottieDemo({
  animationUrl,
  animationData: inlineData,
  poster,
  className,
  onComplete,
}: LottieDemoProps) {
  const containerRef = useRef<HTMLDivElement>(null);
  const lottieRef = useRef<LottieRefCurrentProps>(null);
  const [state, setState] = useState<DemoState>("poster");
  const [animationData, setAnimationData] = useState<object | null>(inlineData || null);

  // Lazy load when 20% visible
  const isInView = useInView(containerRef, { amount: 0.2, once: true });

  // Fetch animation from URL when play is clicked
  const handlePlay = useCallback(async () => {
    if (animationData) {
      setState("playing");
      lottieRef.current?.goToAndPlay(0);
      return;
    }

    if (!animationUrl) {
      console.warn("LottieDemo: No animation URL or data provided");
      return;
    }

    setState("loading");
    try {
      const res = await fetch(animationUrl);
      const data = await res.json();
      setAnimationData(data);
      setState("playing");
    } catch (err) {
      console.error("Failed to load animation:", err);
      setState("poster");
    }
  }, [animationData, animationUrl]);

  const handleComplete = useCallback(() => {
    setState("completed");
    onComplete?.();
  }, [onComplete]);

  const handleReplay = useCallback(() => {
    lottieRef.current?.goToAndPlay(0);
    setState("playing");
  }, []);

  return (
    <div
      ref={containerRef}
      className={cn(
        "relative aspect-video rounded-2xl overflow-hidden bg-gradient-to-br from-primary/5 to-primary/10",
        className
      )}
    >
      {/* Poster state - shown until user clicks play */}
      {(state === "poster" || state === "loading") && (
        <button
          onClick={handlePlay}
          disabled={state === "loading"}
          className="absolute inset-0 w-full h-full group cursor-pointer disabled:cursor-wait"
          aria-label="Play demo"
        >
          <img
            src={poster}
            alt="Demo preview"
            className="w-full h-full object-cover"
          />
          <div className="absolute inset-0 bg-black/20 flex items-center justify-center group-hover:bg-black/30 transition-colors">
            <div className={cn(
              "w-20 h-20 rounded-full bg-primary text-primary-foreground flex items-center justify-center shadow-lg transition-transform",
              state === "loading" ? "animate-pulse" : "group-hover:scale-110"
            )}>
              <Play className="w-10 h-10 ms-1" />
            </div>
          </div>
        </button>
      )}

      {/* Lottie animation - only mount when data loaded and playing/completed */}
      {isInView && animationData && (state === "playing" || state === "completed") && (
        <Lottie
          lottieRef={lottieRef}
          animationData={animationData}
          loop={false}
          autoplay={state === "playing"}
          onComplete={handleComplete}
          className="w-full h-full"
        />
      )}

      {/* Completed state with replay + CTA */}
      {state === "completed" && (
        <div className="absolute inset-0 bg-black/60 flex flex-col items-center justify-center gap-4">
          <Button onClick={handleReplay} variant="outline" size="lg" className="bg-white/10 border-white/20 text-white hover:bg-white/20">
            <RotateCcw className="w-5 h-5 me-2" />
            צפה שוב
          </Button>
          <Button size="lg" asChild>
            <a href="#hero-form">התחל ניסיון חינם</a>
          </Button>
        </div>
      )}
    </div>
  );
}
```

Key implementation details:
- useInView with amount: 0.2 for lazy loading when 20% visible
- Four states: poster, loading, playing, completed
- Supports both URL fetch and inline animation data
- Animation fetched on-demand when user clicks play (saves bandwidth)
- Loading state shows pulsing play button
- CTA appears on completion with replay option
- RTL support: ms-1 for play icon offset, me-2 for button icon
- Accessible: aria-label on play button
  </action>
  <verify>
Run: `cd website && npm run build`
- No TypeScript errors
- LottieDemo component compiles
- lottie-react types resolve correctly
  </verify>
  <done>
LottieDemo component created with lazy loading, URL fetch support, poster fallback, play/replay controls, and completion CTA
  </done>
</task>

<task type="auto">
  <name>Task 3: Create DemoSection wrapper with headline and CTA</name>
  <files>website/components/sections/demo/DemoSection.tsx</files>
  <action>
Create DemoSection.tsx as the section wrapper:

```typescript
"use client";

import { ScrollReveal } from "@/components/motion/ScrollReveal";
import { LottieDemo } from "./LottieDemo";
import { Button } from "@/components/ui/button";
import { cn } from "@/lib/utils";

interface DemoSectionProps {
  className?: string;
  /** URL to fetch Lottie animation from (configured per environment) */
  animationUrl?: string;
}

// Default to placeholder - real URL configured in page or env
const DEFAULT_ANIMATION_URL = process.env.NEXT_PUBLIC_DEMO_ANIMATION_URL;

export function DemoSection({
  className,
  animationUrl = DEFAULT_ANIMATION_URL,
}: DemoSectionProps) {
  return (
    <section className={cn("py-16 md:py-24", className)}>
      <div className="container">
        {/* Section headline */}
        <ScrollReveal className="text-center mb-12">
          <h2 className="text-3xl md:text-4xl font-bold mb-4">
            איך זה עובד? 90 שניות וזהו.
          </h2>
          <p className="text-lg text-muted-foreground max-w-2xl mx-auto">
            שיחה לא נענית → פינדו שולח ווטסאפ → לקוח מגיב → אתם מקבלים ליד חם
          </p>
        </ScrollReveal>

        {/* Demo player */}
        <div className="max-w-4xl mx-auto">
          <LottieDemo
            animationUrl={animationUrl}
            poster="/images/demo-poster.svg"
            className="shadow-2xl"
          />
        </div>

        {/* Below demo CTA (DEMO-03) */}
        <ScrollReveal className="text-center mt-12">
          <p className="text-muted-foreground mb-4">
            מרשים? התחל לאסוף לידים עוד היום
          </p>
          <Button size="lg" asChild>
            <a href="#hero-form">התחל ניסיון חינם</a>
          </Button>
        </ScrollReveal>
      </div>
    </section>
  );
}
```

Notes:
- Hebrew headline: "How does it work? 90 seconds and done."
- Flow description matches CONTEXT.md customer journey
- CTA below demo (DEMO-03 requirement)
- max-w-4xl keeps demo at comfortable viewing size
- shadow-2xl for premium feel
- ScrollReveal for entrance animations
- Animation URL can be passed as prop or via env var (NEXT_PUBLIC_DEMO_ANIMATION_URL)
- No bundled JSON - fetches from URL at runtime
  </action>
  <verify>
Run: `cd website && npm run build`
- No TypeScript errors
- DemoSection compiles and exports correctly
- No JSON import (uses URL fetch pattern)
  </verify>
  <done>
DemoSection wrapper created with headline, LottieDemo player using URL fetch, and post-demo CTA
  </done>
</task>

</tasks>

<verification>
1. Build succeeds: `cd website && npm run build`
2. Manual test: Import DemoSection in a test page
   - Poster image shows initially
   - Click play starts loading (if URL provided) or animation
   - Replay button works
   - CTA buttons link to #hero-form
3. Mobile: Demo responsive (aspect-video maintains ratio)
4. LCP: Demo doesn't load animation until user clicks play (check Network tab)
</verification>

<success_criteria>
- DEMO-01: Video demo component ready (fetches animation from URL)
- DEMO-03: Clear CTA appears after demo ("Start free trial")
- DEMO-04: Demo loads fast (lazy-loaded, poster before play, fetch on demand)
- DEMO-05: Demo works on mobile (responsive aspect-video, touch-friendly controls)
- lottie-react installed and working
- Component architecture ready for real animation URL
</success_criteria>

<output>
After completion, create `.planning/phases/18-emotional-journey-demo/18-02-SUMMARY.md`
</output>
