---
phase: 19-performance-seo-certification
plan: 03
type: execute
wave: 2
depends_on: ["19-01", "19-02"]
files_modified:
  - website/components/sections/conversion/LeadCaptureForm.tsx
  - website/components/sections/conversion/ConversionSection.tsx
  - website/components/sections/hero/StickyCtaBar.tsx
  - website/components/sections/demo/DemoSection.tsx
  - website/components/sections/demo/LottieDemo.tsx
  - website/components/sections/demo/InteractiveDemo.tsx
  - website/lib/posthog/events.ts
autonomous: true

must_haves:
  truths:
    - "CTA clicks tracked with location and text"
    - "Form submissions tracked with success/failure"
    - "Demo views tracked by type (video/interactive/lottie)"
    - "Conversion funnel visible in PostHog"
  artifacts:
    - path: "website/components/sections/conversion/LeadCaptureForm.tsx"
      provides: "Form tracking integration"
      contains: "trackFormSubmit"
    - path: "website/components/sections/demo/DemoSection.tsx"
      provides: "Demo tab tracking"
      contains: "trackDemoView"
  key_links:
    - from: "components/**"
      to: "lib/posthog/events.ts"
      via: "import tracking functions"
      pattern: "import.*trackCtaClick"
---

<objective>
Integrate PostHog event tracking into conversion-critical components: lead capture form, CTA buttons, and demo section to enable funnel analysis.

Purpose: Wire up ANALYTICS-02 (conversion tracking), ANALYTICS-03 (funnel visualization), and ANALYTICS-06 (conversion attribution) by tracking user interactions at key conversion points.
Output: Updated components with PostHog tracking calls.
</objective>

<execution_context>
@C:\Users\דודאלמועלם\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\דודאלמועלם\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/19-performance-seo-certification/19-RESEARCH.md
@.planning/phases/19-performance-seo-certification/19-01-SUMMARY.md
@website/lib/posthog/events.ts
@website/components/sections/conversion/LeadCaptureForm.tsx
@website/components/sections/demo/DemoSection.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add form tracking to LeadCaptureForm</name>
  <files>
    website/components/sections/conversion/LeadCaptureForm.tsx
  </files>
  <action>
Update LeadCaptureForm.tsx to track form interactions:

1. Import tracking functions:
   ```typescript
   import { trackFormStart, trackFormSubmit } from "@/lib/posthog/events";
   ```

2. Track form start when user focuses on first input:
   ```typescript
   const [hasTrackedStart, setHasTrackedStart] = useState(false);

   const handleFocus = () => {
     if (!hasTrackedStart) {
       trackFormStart("lead_capture", source);
       setHasTrackedStart(true);
     }
   };
   ```
   Add `onFocus={handleFocus}` to the first input (phone input).

3. Track form submission in the form action handler:
   After the server action completes:
   ```typescript
   // On success
   trackFormSubmit("lead_capture", source, true);

   // On error
   trackFormSubmit("lead_capture", source, false);
   ```

4. The `source` prop should come from the parent component to attribute conversions:
   - "hero" for hero form
   - "section" for section CTAs
   - "sticky" for sticky bar

Full integration pattern:
```typescript
"use client";

import { useActionState, useState } from "react";
import { submitLead } from "@/app/actions";
import { PhoneInput } from "./PhoneInput";
import { FormSuccess } from "./FormSuccess";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { trackFormStart, trackFormSubmit } from "@/lib/posthog/events";
import { cn } from "@/lib/utils";
import { AnimatePresence, m } from "motion/react";

interface LeadCaptureFormProps {
  source?: string;
  className?: string;
}

export function LeadCaptureForm({ source = "unknown", className }: LeadCaptureFormProps) {
  const [state, formAction, isPending] = useActionState(submitLead, null);
  const [hasTrackedStart, setHasTrackedStart] = useState(false);

  // Track form start on first interaction
  const handleFirstInteraction = () => {
    if (!hasTrackedStart) {
      trackFormStart("lead_capture", source);
      setHasTrackedStart(true);
    }
  };

  // Track submission result when state changes
  useEffect(() => {
    if (state?.success !== undefined) {
      trackFormSubmit("lead_capture", source, state.success);
    }
  }, [state?.success, source]);

  // ... rest of existing component logic ...
}
```
  </action>
  <verify>
    - LeadCaptureForm imports tracking functions
    - Form start tracked on first input focus
    - Form submit tracked with success/failure status
    - Source attribution passed through
  </verify>
  <done>Lead capture form tracks start and submit events with source attribution</done>
</task>

<task type="auto">
  <name>Task 2: Add demo tracking to DemoSection and demo components</name>
  <files>
    website/components/sections/demo/DemoSection.tsx
    website/components/sections/demo/LottieDemo.tsx
    website/components/sections/demo/InteractiveDemo.tsx
  </files>
  <action>
1. Update DemoSection.tsx to track tab switches:
   ```typescript
   import { trackDemoView } from "@/lib/posthog/events";

   // In the tab handler:
   const handleTabChange = (tab: "video" | "interactive") => {
     setActiveTab(tab);
     trackDemoView(tab);
   };
   ```

2. Update LottieDemo.tsx to track play:
   ```typescript
   import { trackDemoView, trackDemoComplete } from "@/lib/posthog/events";

   // When user clicks play button:
   const handlePlay = () => {
     setState("loading");
     trackDemoView("lottie");
     // ... existing load logic ...
   };

   // When animation completes (if applicable):
   const handleComplete = () => {
     trackDemoComplete("lottie");
   };
   ```

3. Update InteractiveDemo.tsx to track interactive demo:
   ```typescript
   import { trackDemoView } from "@/lib/posthog/events";

   // When user clicks to load iframe:
   const handleLoadDemo = () => {
     setIsLoaded(true);
     trackDemoView("interactive");
   };
   ```

4. For VideoTestimonial, if used as demo, track video interactions:
   Already in separate section, but if needed:
   ```typescript
   import { trackDemoView } from "@/lib/posthog/events";

   // On video play
   const handlePlay = () => {
     trackDemoView("video");
   };
   ```
  </action>
  <verify>
    - DemoSection tracks tab changes
    - LottieDemo tracks play clicks
    - InteractiveDemo tracks iframe load
    - Events appear in PostHog with demo_type property
  </verify>
  <done>Demo components track view events by type</done>
</task>

<task type="auto">
  <name>Task 3: Add CTA tracking to ConversionSection and StickyCtaBar</name>
  <files>
    website/components/sections/conversion/ConversionSection.tsx
    website/components/sections/hero/StickyCtaBar.tsx
  </files>
  <action>
1. Update ConversionSection.tsx to pass proper source to LeadCaptureForm:

   The ConversionSection already has a `variant` prop. Use this as the source:
   ```typescript
   import { trackCtaClick } from "@/lib/posthog/events";

   // Map variant to tracking source
   const getTrackingSource = (variant: string, id?: string) => {
     if (id === "hero-form") return "hero";
     switch (variant) {
       case "hero": return "hero";
       case "section": return "section";
       default: return variant;
     }
   };
   ```

2. Pass source to LeadCaptureForm:
   ```typescript
   <LeadCaptureForm source={getTrackingSource(variant, id)} />
   ```

3. Also track CTA button clicks in any standalone CTAs:
   If there are Button components that link to forms, add onClick tracking:
   ```typescript
   const handleCtaClick = () => {
     trackCtaClick(source, buttonText);
   };
   ```

4. Update StickyCtaBar.tsx to track clicks:
   ```typescript
   import { trackCtaClick } from "@/lib/posthog/events";

   const handleClick = () => {
     trackCtaClick("sticky_bar", "התחל בחינם");
     // ... existing scroll logic ...
   };
   ```
  </action>
  <verify>
    - ConversionSection passes source to LeadCaptureForm
    - StickyCtaBar tracks clicks with location "sticky_bar"
    - Source values match funnel analysis needs: hero, section, sticky_bar
    - CTA clicks tracked with location attribution
  </verify>
  <done>Conversion components track events with proper source attribution</done>
</task>

</tasks>

<verification>
1. Open browser dev tools Network tab
2. Fill in lead form - see form_started and form_submitted events
3. Click demo tabs - see demo_viewed events
4. Click sticky CTA - see cta_clicked event
5. Check PostHog dashboard for events (requires env var set)
</verification>

<success_criteria>
- form_started event fires on first form interaction
- form_submitted event fires on submit with success boolean
- demo_viewed event fires with correct demo_type
- cta_clicked event fires with button_location
- All events include proper attribution properties
- Build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/19-performance-seo-certification/19-03-SUMMARY.md`
</output>
