---
phase: 23-3d-phone-mockup
plan: 03
type: execute
wave: 3
depends_on: ["23-02"]
files_modified:
  - website/components/sections/hero/PhoneMockup.tsx
autonomous: true

must_haves:
  truths:
    - "Phone moves slower than content during scroll (parallax effect)"
    - "Phone tilts subtly toward cursor on desktop (mouse parallax)"
    - "Mobile devices have scroll parallax only (no mouse tracking)"
    - "Parallax respects prefers-reduced-motion"
    - "No layout shift when parallax activates (CLS = 0)"
  artifacts:
    - path: "website/components/sections/hero/PhoneMockup.tsx"
      provides: "Phone mockup with scroll and mouse parallax"
      contains: "useScroll"
  key_links:
    - from: "website/components/sections/hero/PhoneMockup.tsx"
      to: "motion/react"
      via: "Motion hooks for parallax"
      pattern: "useScroll|useTransform|useMotionValue"
---

<objective>
Add parallax movement to the phone mockup - scroll parallax for all devices, mouse tracking parallax for desktop only.

Purpose: Create depth and interactivity that makes the hero feel alive and premium.
Output: PhoneMockup component with Motion-powered parallax effects.
</objective>

<execution_context>
@C:\Users\דודאלמועלם\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\דודאלמועלם\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/23-3d-phone-mockup/23-CONTEXT.md
@.planning/phases/23-3d-phone-mockup/23-RESEARCH.md
@.planning/phases/23-3d-phone-mockup/23-02-SUMMARY.md

# Component to enhance
@website/components/sections/hero/PhoneMockup.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add scroll parallax effect</name>
  <files>website/components/sections/hero/PhoneMockup.tsx</files>
  <action>
Add scroll-linked parallax using Motion's useScroll and useTransform hooks.

Per CONTEXT.md: "Subtle movement intensity (~20-40px), natural scroll exit"

Implementation:

1. Import Motion hooks:
```tsx
import { m, useScroll, useTransform } from "motion/react";
import { useRef } from "react";
```

2. Add ref and scroll tracking in component:
```tsx
const containerRef = useRef<HTMLDivElement>(null);

// Track scroll progress from hero start to hero exit
const { scrollYProgress } = useScroll({
  target: containerRef,
  offset: ["start start", "end start"],
});

// Map scroll to Y offset (0 to 40px - phone moves slower than scroll)
const scrollY = useTransform(scrollYProgress, [0, 1], [0, 40]);
```

3. Wrap the phone container in m.div with style:
```tsx
<m.div
  ref={containerRef}
  className={cn("relative", className)}
  style={{ y: scrollY }}
>
  {/* Screen glow, phone frame, etc */}
</m.div>
```

The phone will move 40px slower than the page scroll, creating subtle depth.
  </action>
  <verify>
Run `npm run dev` and scroll the hero section.
Phone should:
1. Stay visible slightly longer than surrounding content
2. Move ~40px slower relative to scroll
3. No jank or stuttering
4. Natural exit as you scroll past
  </verify>
  <done>
Scroll parallax implemented with 40px movement range.
Phone creates depth by moving slower than page content.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add mouse parallax (desktop only)</name>
  <files>website/components/sections/hero/PhoneMockup.tsx</files>
  <action>
Add mouse-tracking parallax that tilts the phone toward cursor position.

Per CONTEXT.md: "Mouse + scroll on desktop, scroll only on mobile, slight tilt toward cursor"

Implementation:

1. Add state and Motion values:
```tsx
import { useState, useEffect } from "react";
import { useMotionValue, useSpring } from "motion/react";

const [isMobile, setIsMobile] = useState(true);

// Mouse position (normalized -0.5 to 0.5)
const mouseX = useMotionValue(0);
const mouseY = useMotionValue(0);

// Smooth spring for natural feel
const springConfig = { stiffness: 100, damping: 30 };
const rotateX = useSpring(useTransform(mouseY, [-0.5, 0.5], [3, -3]), springConfig);
const rotateY = useSpring(useTransform(mouseX, [-0.5, 0.5], [-3, 3]), springConfig);
```

2. Add mobile detection and mouse listener:
```tsx
useEffect(() => {
  const checkMobile = () => {
    setIsMobile(window.matchMedia("(max-width: 1024px)").matches);
  };
  checkMobile();
  window.addEventListener("resize", checkMobile);
  return () => window.removeEventListener("resize", checkMobile);
}, []);

useEffect(() => {
  if (isMobile) return;

  // Respect reduced motion preference
  const prefersReducedMotion = window.matchMedia(
    "(prefers-reduced-motion: reduce)"
  ).matches;
  if (prefersReducedMotion) return;

  const handleMouseMove = (e: MouseEvent) => {
    const { innerWidth, innerHeight } = window;
    mouseX.set((e.clientX / innerWidth) - 0.5);
    mouseY.set((e.clientY / innerHeight) - 0.5);
  };

  window.addEventListener("mousemove", handleMouseMove);
  return () => window.removeEventListener("mousemove", handleMouseMove);
}, [isMobile, mouseX, mouseY]);
```

3. Apply rotation to m.div style:
```tsx
<m.div
  ref={containerRef}
  className={cn("relative", className)}
  style={{
    y: scrollY,
    rotateX: isMobile ? 0 : rotateX,
    rotateY: isMobile ? 0 : rotateY,
    transformStyle: "preserve-3d",
  }}
>
```

**Key Points:**
- 3 degree rotation max (subtle, not dramatic)
- Desktop only (isMobile check)
- Respects prefers-reduced-motion
- Spring easing for smooth, natural feel
- Combines with scroll parallax (both y and rotate active)
  </action>
  <verify>
On DESKTOP (>1024px):
1. Move mouse around screen
2. Phone should tilt subtly toward cursor
3. Movement should feel smooth/springy, not jittery
4. Scroll parallax still works alongside mouse parallax

On MOBILE (<1024px):
1. Phone should NOT respond to touch/pointer
2. Scroll parallax still works
3. No jank during scroll

Test prefers-reduced-motion:
1. Enable "Reduce motion" in OS settings
2. Both parallax effects should be disabled
  </verify>
  <done>
Mouse parallax implemented for desktop only.
Phone tilts 3 degrees toward cursor with spring easing.
Mobile devices use scroll parallax only.
prefers-reduced-motion respected.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add contain-layout for CLS prevention</name>
  <files>website/components/sections/hero/PhoneMockup.tsx</files>
  <action>
Add CSS containment to prevent layout shift when parallax kicks in.

Add to the outer m.div className:
```tsx
<m.div
  ref={containerRef}
  className={cn(
    "relative",
    "contain-layout", // Prevents CLS from parallax transforms
    className
  )}
  style={{...}}
>
```

The `contain-layout` class tells the browser this element's layout is independent from its ancestors, preventing transform-related layout recalculations from propagating.
  </action>
  <verify>
Run Lighthouse on the page.
CLS should be 0.
No visible "jump" when parallax initializes.
  </verify>
  <done>
Layout containment added for CLS prevention.
Parallax transforms don't cause layout shift.
  </done>
</task>

</tasks>

<verification>
1. Desktop: Mouse movement causes subtle phone tilt
2. Desktop: Scroll causes phone to move slower than content
3. Mobile: Scroll parallax works, no mouse tracking
4. Reduced motion: Both parallax effects disabled
5. CLS = 0 (Lighthouse verification)
6. No jank at 60fps
7. `npm run build` passes
</verification>

<success_criteria>
- Scroll parallax creates depth (40px range)
- Mouse parallax tilts phone toward cursor (3 deg range)
- Mobile devices have scroll-only parallax
- prefers-reduced-motion disables all parallax
- CLS = 0 (no layout shift)
- 60fps animation performance maintained
</success_criteria>

<output>
After completion, create `.planning/phases/23-3d-phone-mockup/23-03-SUMMARY.md`
</output>
