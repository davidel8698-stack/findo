---
phase: 25-animation-choreography
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - website/components/motion/variants.ts
  - website/lib/animation.ts
  - website/components/motion/SectionReveal.tsx
  - website/components/motion/index.ts
autonomous: true

must_haves:
  truths:
    - "Each section has scroll-triggered reveal animation"
    - "Stagger delays between child elements are 50-75ms (fast cascade)"
    - "Scroll trigger fires at 20-30% visibility threshold"
    - "Animations play only once (page locks in as you scroll)"
  artifacts:
    - path: "website/components/motion/SectionReveal.tsx"
      provides: "Scroll-triggered section reveal with personality variants"
      exports: ["SectionReveal", "SectionRevealItem"]
    - path: "website/components/motion/variants.ts"
      provides: "Section-specific reveal variants (fadeInRise, fastStaggerContainer)"
      contains: "fadeInRise"
    - path: "website/lib/animation.ts"
      provides: "Fast stagger timing constant"
      contains: "fastStagger"
  key_links:
    - from: "website/components/motion/SectionReveal.tsx"
      to: "website/components/motion/variants.ts"
      via: "imports variants"
      pattern: "import.*variants"
    - from: "website/components/motion/SectionReveal.tsx"
      to: "motion/react"
      via: "whileInView prop"
      pattern: "whileInView"
---

<objective>
Create the scroll reveal system with section-specific personalities and fast cascade staggering per CONTEXT.md.

Purpose: Implement scroll-triggered reveals that feel "unified" - items within a group animate together with fast 50-75ms delays, creating connected visual groups.

Output:
- Enhanced variants.ts with section-specific reveal variants
- SectionReveal component with personality system
- Fast stagger timing constants in animation.ts
</objective>

<execution_context>
@C:\Users\דודאלמועלם\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\דודאלמועלם\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/25-animation-choreography/25-CONTEXT.md
@.planning/phases/25-animation-choreography/25-RESEARCH.md

Reference files:
@website/components/motion/variants.ts
@website/components/motion/ScrollReveal.tsx
@website/components/motion/StaggerContainer.tsx
@website/lib/animation.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add fast stagger constant and viewport config to animation.ts</name>
  <files>website/lib/animation.ts</files>
  <action>
Add the fast stagger configuration for Phase 25 section reveals.

Add to animation.ts:
```typescript
/**
 * FAST STAGGER CONFIG - Phase 25
 * Fast cascade (50-75ms) per CONTEXT.md for unified group feel
 * Use for scroll-triggered section reveals
 */
export const fastStagger = {
  staggerChildren: 0.065, // 65ms - middle of 50-75ms range
  delayChildren: 0.1,
};

/**
 * SECTION REVEAL VIEWPORT - Phase 25
 * Early trigger (20-30% visible) per CONTEXT.md
 * Anticipatory - ensures animations are seen, feels responsive
 */
export const sectionViewport = {
  once: true,      // Animate once only - page "locks in"
  amount: 0.2,     // 20% visibility threshold
  margin: "-50px", // Trigger slightly before visible
};
```

These will be used by SectionReveal component.
  </action>
  <verify>File contains fastStagger and sectionViewport exports</verify>
  <done>Fast stagger and section viewport configs added to animation.ts</done>
</task>

<task type="auto">
  <name>Task 2: Add section-specific reveal variants to variants.ts</name>
  <files>website/components/motion/variants.ts</files>
  <action>
Add section personality variants per CONTEXT.md scroll reveal behavior.

Add these variants to variants.ts:
```typescript
import { fastStagger } from "@/lib/animation";

// ===== SECTION REVEAL VARIANTS - Phase 25 =====

/**
 * Standard fade + rise (20-30px) per CONTEXT.md
 * Default personality for most sections
 */
export const fadeInRise: Variants = {
  hidden: { opacity: 0, y: 30 },
  visible: {
    opacity: 1,
    y: 0,
    transition: {
      ...springGentle,
    },
  },
};

/**
 * Fast cascade container for section reveals
 * 50-75ms stagger per CONTEXT.md
 */
export const fastStaggerContainer: Variants = {
  hidden: { opacity: 0 },
  visible: {
    opacity: 1,
    transition: {
      ...fastStagger,
    },
  },
};

/**
 * Reduced motion fallback - opacity only, 150-200ms
 * Per CONTEXT.md accessibility requirements
 */
export const reducedMotionFade: Variants = {
  hidden: { opacity: 0 },
  visible: {
    opacity: 1,
    transition: { duration: 0.15 },
  },
};

/**
 * Slide from start (left in LTR, right in RTL)
 * For testimonials alternating pattern
 */
export const slideFromStart: Variants = {
  hidden: { opacity: 0, x: -50 },
  visible: {
    opacity: 1,
    x: 0,
    transition: springGentle,
  },
};

/**
 * Slide from end (right in LTR, left in RTL)
 * For testimonials alternating pattern
 */
export const slideFromEnd: Variants = {
  hidden: { opacity: 0, x: 50 },
  visible: {
    opacity: 1,
    x: 0,
    transition: springGentle,
  },
};
```

Ensure all variants are exported.
  </action>
  <verify>variants.ts exports fadeInRise, fastStaggerContainer, reducedMotionFade, slideFromStart, slideFromEnd</verify>
  <done>Section-specific reveal variants added with fast stagger and reduced motion support</done>
</task>

<task type="auto">
  <name>Task 3: Create SectionReveal component with personality system</name>
  <files>website/components/motion/SectionReveal.tsx, website/components/motion/index.ts</files>
  <action>
Create the SectionReveal component that wraps sections with scroll-triggered reveal animations.

**SectionReveal.tsx:**
```typescript
"use client";

import { type ReactNode } from "react";
import { m, type Variants, useReducedMotion } from "motion/react";
import { cn } from "@/lib/utils";
import { sectionViewport } from "@/lib/animation";
import {
  fadeInRise,
  fastStaggerContainer,
  reducedMotionFade,
} from "./variants";

type SectionPersonality = 'fade' | 'scaleIn';

interface SectionRevealProps {
  children: ReactNode;
  className?: string;
  /** Section personality - default 'fade' */
  personality?: SectionPersonality;
  /** Trigger threshold (0-1) - default 0.2 per CONTEXT.md */
  threshold?: number;
  /** Stagger delay between children (ms) - default 65ms per CONTEXT.md */
  staggerMs?: number;
  /** Disable stagger for single-child sections */
  noStagger?: boolean;
}

/**
 * SectionReveal - Scroll-triggered section reveal with personality
 *
 * Implements CONTEXT.md scroll reveal behavior:
 * - Early trigger (20-30% visible)
 * - Animate once only
 * - Fast cascade (50-75ms) stagger
 * - Reduced motion fallback
 */
export function SectionReveal({
  children,
  className,
  personality = 'fade',
  threshold = sectionViewport.amount,
  staggerMs = 65,
  noStagger = false,
}: SectionRevealProps) {
  const prefersReducedMotion = useReducedMotion();

  const containerVariants: Variants = {
    hidden: { opacity: 0 },
    visible: {
      opacity: 1,
      transition: noStagger ? {} : {
        staggerChildren: prefersReducedMotion ? 0.05 : staggerMs / 1000,
        delayChildren: 0.1,
      },
    },
  };

  return (
    <m.div
      initial="hidden"
      whileInView="visible"
      viewport={{
        once: true,  // Per CONTEXT.md: animate once only
        amount: threshold,
        margin: "-50px",
      }}
      variants={containerVariants}
      className={cn(className)}
    >
      {children}
    </m.div>
  );
}

interface SectionRevealItemProps {
  children: ReactNode;
  className?: string;
  /** Custom variants override */
  variants?: Variants;
}

/**
 * SectionRevealItem - Child element that animates within SectionReveal
 *
 * Uses fadeInRise by default (30px rise + fade)
 * Respects parent's stagger timing
 */
export function SectionRevealItem({
  children,
  className,
  variants,
}: SectionRevealItemProps) {
  const prefersReducedMotion = useReducedMotion();
  const activeVariants = variants ?? (prefersReducedMotion ? reducedMotionFade : fadeInRise);

  return (
    <m.div variants={activeVariants} className={cn(className)}>
      {children}
    </m.div>
  );
}
```

**Update index.ts** to export:
```typescript
export { SectionReveal, SectionRevealItem } from "./SectionReveal";
```
  </action>
  <verify>SectionReveal.tsx exists; index.ts exports SectionReveal and SectionRevealItem</verify>
  <done>SectionReveal component created with personality system, fast stagger, and reduced motion support</done>
</task>

</tasks>

<verification>
1. Run `npm run build` - no TypeScript errors
2. Run `npm run dev`
3. Create a test in any section:
   ```tsx
   <SectionReveal>
     <SectionRevealItem>Item 1</SectionRevealItem>
     <SectionRevealItem>Item 2</SectionRevealItem>
     <SectionRevealItem>Item 3</SectionRevealItem>
   </SectionReveal>
   ```
4. Verify scroll reveals trigger at ~20% visibility
5. Verify items animate in with ~65ms stagger (fast cascade)
6. Test reduced motion: items should fade without movement
7. Verify animations only play once (scroll up/down doesn't re-trigger)
</verification>

<success_criteria>
- SectionReveal triggers at 20% viewport visibility
- Children animate with fast 50-75ms stagger delays
- Animations play once and don't re-trigger on scroll
- Reduced motion shows opacity-only transitions
- No console errors or hydration warnings
</success_criteria>

<output>
After completion, create `.planning/phases/25-animation-choreography/25-02-SUMMARY.md`
</output>
