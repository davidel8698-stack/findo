---
phase: 25-animation-choreography
plan: 03
type: execute
wave: 2
depends_on: ["25-02"]
files_modified:
  - website/lib/hooks/useDirection.ts
  - website/lib/hooks/index.ts
  - website/components/sections/social-proof/SocialProofCounters.tsx
  - website/components/sections/social-proof/TestimonialsCarousel.tsx
autonomous: true

must_haves:
  truths:
    - "Stats numbers count up when section enters viewport"
    - "Testimonial cards slide in from alternating sides with stagger"
    - "Slide animations work right-to-left in RTL (start=right, end=left)"
    - "Stats counter uses ease-out (fast start, slow landing)"
  artifacts:
    - path: "website/lib/hooks/useDirection.ts"
      provides: "RTL direction detection hook"
      exports: ["useDirection"]
    - path: "website/components/sections/social-proof/SocialProofCounters.tsx"
      provides: "Stats counters with SectionReveal integration"
      contains: "SectionReveal"
    - path: "website/components/sections/social-proof/TestimonialsCarousel.tsx"
      provides: "Testimonials with alternating slide-in animations"
      contains: "slideFrom"
  key_links:
    - from: "website/components/sections/social-proof/TestimonialsCarousel.tsx"
      to: "website/lib/hooks/useDirection.ts"
      via: "useDirection hook"
      pattern: "useDirection"
    - from: "website/components/sections/social-proof/SocialProofCounters.tsx"
      to: "website/components/motion/SectionReveal.tsx"
      via: "SectionReveal wrapper"
      pattern: "SectionReveal"
---

<objective>
Enhance stats counters and testimonials with section-specific animation personalities per CONTEXT.md.

Purpose: Stats create "unified impact, single moment of arrival" with simultaneous count-up; Testimonials get distinct slide-in pattern that feels dynamic while maintaining RTL correctness.

Output:
- useDirection hook for RTL-aware slide animations
- Enhanced SocialProofCounters with SectionReveal integration
- TestimonialsCarousel with alternating slide-in animations
</objective>

<execution_context>
@C:\Users\דודאלמועלם\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\דודאלמועלם\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/25-animation-choreography/25-CONTEXT.md
@.planning/phases/25-animation-choreography/25-RESEARCH.md
@.planning/phases/25-animation-choreography/25-02-SUMMARY.md

Reference files:
@website/components/sections/social-proof/SocialProofCounters.tsx
@website/components/sections/social-proof/TestimonialsCarousel.tsx
@website/components/motion/variants.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useDirection hook for RTL-aware animations</name>
  <files>website/lib/hooks/useDirection.ts, website/lib/hooks/index.ts</files>
  <action>
Create a hook that detects document direction for RTL-aware slide animations.

**useDirection.ts:**
```typescript
"use client";

import { useState, useEffect } from "react";

export type Direction = "ltr" | "rtl";

/**
 * useDirection - Detects document direction for RTL-aware animations
 *
 * Used by slide animations to calculate correct x-offset:
 * - In LTR: "from start" = from left (-x), "from end" = from right (+x)
 * - In RTL: "from start" = from right (+x), "from end" = from left (-x)
 */
export function useDirection(): Direction {
  const [direction, setDirection] = useState<Direction>("rtl"); // Default RTL for Hebrew

  useEffect(() => {
    const dir = document.documentElement.dir as Direction;
    setDirection(dir === "ltr" ? "ltr" : "rtl");

    // Optional: observe direction changes (rare but possible)
    const observer = new MutationObserver(() => {
      const newDir = document.documentElement.dir as Direction;
      setDirection(newDir === "ltr" ? "ltr" : "rtl");
    });

    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ["dir"],
    });

    return () => observer.disconnect();
  }, []);

  return direction;
}

/**
 * Helper to calculate slide X offset based on direction
 * @param direction - 'start' (natural start) or 'end' (natural end)
 * @param magnitude - pixel offset (default 50)
 * @param isRTL - whether document is RTL
 */
export function getSlideX(
  direction: "start" | "end",
  magnitude: number = 50,
  isRTL: boolean = true
): number {
  if (direction === "end") {
    // "from end" = from right in LTR, from left in RTL
    return isRTL ? -magnitude : magnitude;
  } else {
    // "from start" = from left in LTR, from right in RTL
    return isRTL ? magnitude : -magnitude;
  }
}
```

**Update index.ts** to export:
```typescript
export { useDirection, getSlideX, type Direction } from "./useDirection";
```

Also ensure useReducedMotion and useHeroEntrance are exported if not already.
  </action>
  <verify>useDirection.ts exists with getSlideX helper; index.ts exports all hooks</verify>
  <done>useDirection hook created with RTL-aware slide X calculation helper</done>
</task>

<task type="auto">
  <name>Task 2: Enhance SocialProofCounters with SectionReveal</name>
  <files>website/components/sections/social-proof/SocialProofCounters.tsx</files>
  <action>
Update SocialProofCounters to use the new SectionReveal system.

Changes:
1. Replace individual ScrollReveal wrappers with single SectionReveal + SectionRevealItem pattern
2. Keep existing AnimatedCounter spring animation (already correct per CONTEXT.md)
3. Stats should animate simultaneously ("unified impact") - use small stagger (50ms)

The existing AnimatedCounter already uses:
- useSpring with stiffness:100, damping:30 (matches CONTEXT.md ease-out: fast start, slow landing)
- useInView with once:true
- 2-2.5s implied by spring physics

Update pattern:
```tsx
import { SectionReveal, SectionRevealItem } from "@/components/motion";

export function SocialProofCounters({ className }: SocialProofCountersProps) {
  return (
    <div className={cn("w-full", className)}>
      <SectionReveal noStagger>
        <SectionRevealItem>
          <h2 id="social-proof-heading" className={...}>
            המספרים מדברים בעד עצמם
          </h2>
        </SectionRevealItem>
      </SectionReveal>

      <SectionReveal staggerMs={50} className="grid grid-cols-2 md:grid-cols-4 gap-6 md:gap-8 max-w-4xl mx-auto">
        {metrics.map((metric) => (
          <SectionRevealItem key={metric.label}>
            {metric.type === "animated" ? (
              <AnimatedCounter ... />
            ) : (
              <StaticMetric ... />
            )}
          </SectionRevealItem>
        ))}
      </SectionReveal>
    </div>
  );
}
```

Note: AnimatedCounter already has its own useInView for the count-up trigger. The SectionReveal handles the fade-in reveal, while AnimatedCounter handles the number counting. This creates layered animation: reveal + count.
  </action>
  <verify>SocialProofCounters uses SectionReveal; stats animate in with stagger then count up</verify>
  <done>SocialProofCounters enhanced with SectionReveal wrapper; simultaneous count-up preserved</done>
</task>

<task type="auto">
  <name>Task 3: Add alternating slide-in to TestimonialsCarousel</name>
  <files>website/components/sections/social-proof/TestimonialsCarousel.tsx</files>
  <action>
Update TestimonialsCarousel to use alternating slide-in animations for testimonial cards.

Per CONTEXT.md: "Testimonials: slide from sides" with alternating pattern.

Implementation approach - since this is a carousel, we'll animate the visible cards on scroll reveal with alternating directions:

```tsx
"use client";

import { m, type Variants, useReducedMotion } from "motion/react";
import {
  Carousel,
  CarouselContent,
  CarouselItem,
  CarouselNext,
  CarouselPrevious,
} from "@/components/ui/carousel";
import { TestimonialCard, type Testimonial } from "./TestimonialCard";
import { SectionReveal, SectionRevealItem } from "@/components/motion";
import { useDirection, getSlideX } from "@/lib/hooks";
import { springGentle } from "@/lib/animation";
import { reducedMotionFade } from "@/components/motion/variants";

// ... testimonials data stays the same ...

export function TestimonialsCarousel({ className }: TestimonialsCarouselProps) {
  const prefersReducedMotion = useReducedMotion();
  const direction = useDirection();
  const isRTL = direction === "rtl";

  // Create alternating slide variants
  const getSlideVariant = (index: number): Variants => {
    if (prefersReducedMotion) {
      return reducedMotionFade;
    }

    // Alternate: even from start, odd from end
    const fromStart = index % 2 === 0;
    const xOffset = getSlideX(fromStart ? "start" : "end", 50, isRTL);

    return {
      hidden: { opacity: 0, x: xOffset },
      visible: {
        opacity: 1,
        x: 0,
        transition: springGentle,
      },
    };
  };

  return (
    <SectionReveal className={className}>
      <div className="w-full">
        {/* Section heading */}
        <SectionRevealItem>
          <h2 className="text-3xl font-bold text-center mb-8">
            מה הלקוחות שלנו אומרים
          </h2>
        </SectionRevealItem>

        {/* Carousel container */}
        <div className="relative px-16 md:px-20">
          <Carousel
            dir="rtl"
            opts={{
              direction: "rtl",
              align: "start",
              loop: true,
            }}
            className="w-full"
          >
            <CarouselContent className="-ms-4">
              {testimonials.map((testimonial, index) => (
                <CarouselItem
                  key={testimonial.id}
                  className="ps-4 basis-full md:basis-1/2 lg:basis-1/3"
                >
                  <m.div
                    variants={getSlideVariant(index)}
                    initial="hidden"
                    whileInView="visible"
                    viewport={{ once: true, amount: 0.2 }}
                  >
                    <TestimonialCard
                      quote={testimonial.quote}
                      name={testimonial.name}
                      business={testimonial.business}
                      metric={testimonial.metric}
                      avatarSrc={testimonial.avatarSrc}
                      industry={testimonial.industry}
                    />
                  </m.div>
                </CarouselItem>
              ))}
            </CarouselContent>

            <CarouselPrevious className="rtl:rotate-180" />
            <CarouselNext className="rtl:rotate-180" />
          </Carousel>
        </div>
      </div>
    </SectionReveal>
  );
}
```

Key changes:
1. Import useDirection and getSlideX for RTL-aware offsets
2. Create getSlideVariant function that alternates direction based on index
3. Each testimonial card gets individual whileInView animation
4. Reduced motion users get opacity-only fade
  </action>
  <verify>TestimonialsCarousel cards slide in from alternating sides; RTL direction is respected</verify>
  <done>TestimonialsCarousel has alternating slide-in animations with RTL support</done>
</task>

</tasks>

<verification>
1. Run `npm run build` - no TypeScript errors
2. Run `npm run dev` and scroll to:
   - **Stats section**: Verify counters fade in with stagger, then count up simultaneously
   - **Testimonials section**: Verify cards slide in from alternating sides
3. Test RTL correctness:
   - In RTL: first card should slide from right (+x), second from left (-x)
   - Check that animations feel natural for Hebrew reading direction
4. Test reduced motion:
   - Stats: should fade in, numbers appear at final value
   - Testimonials: should fade in without slide motion
5. Verify 60fps performance in DevTools Performance tab during scroll
</verification>

<success_criteria>
- Stats counters reveal with stagger then count up together (unified impact)
- Testimonial cards slide in from alternating sides with 75ms stagger
- RTL slide direction is correct (even cards from right, odd from left in RTL)
- Reduced motion users see opacity-only fallbacks
- No layout shift during animations
</success_criteria>

<output>
After completion, create `.planning/phases/25-animation-choreography/25-03-SUMMARY.md`
</output>
